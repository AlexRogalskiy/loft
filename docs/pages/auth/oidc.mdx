---
title: OpenID Connect Authentication
sidebar_label: OpenID Connect Auth
---

import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'
import DynamicMembershipFragment from '../fragments/teams/dynamic-membership.mdx'

If you configure authentication through OpenID Connect (OIDC), users log in to the loft interface via an OIDC single sign-on (SSO) provider, such as Okta, KeyCloak, or dex.
In this case, you usually do not create user accounts in loft and manage them through the OIDC provider that delegates the correct authentication to external providers, such as Github, Google or Microsoft.

OpenID Connect allows users to authenticate using a third-party provider which is useful if organizations want to:
- provide self sign-up for their users
- [mirror the team memberships](#mirror-team-memberships) of their users from another provider
- enforce security standards such as two factor authentication (2FA)

OpenID Connect authentication is a paid feature of loft, so please make sure this feature is enabled in your loft instance.

## Optional: Setup Dex for Single Sign On

If you do not already have an OIDC provider, such as dex, Okta or KeyCloak, this section will show you how to deploy dex to let your users authenticate through external OAuth providers, such as Github, Google or Microsoft.
Please make sure you have access to a Kubernetes cluster and `kubectl` and `helm` installed and configured.

Depending on your preferred OAuth provider, you'll have to create a different dex-values.yaml locally:

<Tabs
  groupId="oidc-connectors"
  defaultValue="github"
  values={[
    { label: 'GitHub', value: 'github', },
    { label: 'GitLab', value: 'gitlab', },
    { label: 'Google', value: 'google', },
    { label: 'Microsoft', value: 'microsoft', },
    { label: 'Others (LDAP, SAML, ...)', value: 'others', },
  ]
}>
<TabItem value="github">

For an extensive github dex configuration take a look at the official [dex documentation](https://github.com/dexidp/dex/blob/master/Documentation/connectors/github.md).

In order to configure Github for dex, you'll have to create a new Github Application for dex and copy the client id and secret to a file called `dex-values.yaml`:
```yaml
config:
  issuer: http://my-dex-issuer.com                   # The domain of where dex will be available at
  storage:
    type: kubernetes
    config:
      inCluster: true
  web:
    http: 0.0.0.0:5556
    # Uncomment for HTTPS options.
    # https: 127.0.0.1:5554
    # tlsCert: /etc/dex/tls.crt
    # tlsKey: /etc/dex/tls.key
  connectors:
  - type: github
    id: github
    name: GitHub
    config:
      clientID: APP CLIENT ID                          # The github application client id
      clientSecret: APP CLIENT SECRET                  # The github application client secret
      redirectURI: http://my-dex-issuer.com/callback   # The domain where dex will be available at
      loadAllGroups: true
      useLoginAsID: true
  oauth2:
    skipApprovalScreen: true
  staticClients:
  - id: loft
    redirectURIs:
    - 'https://my-loft-domain.com/auth/oidc/callback'   # The domain where loft is available
    name: 'Loft'
    secret: ANYSECRETKEY                                # The secret key that you will configure for loft
```

</TabItem>
<TabItem value="gitlab">

#TODO

</TabItem>
<TabItem value="google">

#TODO

</TabItem>
<TabItem value="microsoft">

#TODO

</TabItem>
<TabItem value="others">

Other supported auth providers include:
- [GitHub Enterprise](https://github.com/dexidp/dex/blob/master/Documentation/connectors/github.md#github-enterprise)
- [LDAP](https://github.com/dexidp/dex/blob/master/Documentation/connectors/ldap.md)
- [SAML 2.0](https://github.com/dexidp/dex/blob/master/Documentation/connectors/saml.md)
- [OpenID Connect](https://github.com/dexidp/dex/blob/master/Documentation/connectors/oidc.md)
- [AuthProxy](https://github.com/dexidp/dex/blob/master/Documentation/connectors/authproxy.md)
- [OpenShift](https://github.com/dexidp/dex/blob/master/Documentation/connectors/openshift.md)
- [Atlassian Crowd](https://github.com/dexidp/dex/blob/master/Documentation/connectors/atlassian-crowd.md)
- [Bitbucket Cloud](https://github.com/dexidp/dex/blob/master/Documentation/connectors/bitbucketcloud.md)
- [LinkedIn](https://github.com/dexidp/dex/blob/master/Documentation/connectors/linkedin.md)
- [Gitea](https://github.com/dexidp/dex/blob/master/Documentation/connectors/gitea.md)

For more details, click on the respective provider and [click here for a full list of all supported providers](https://github.com/dexidp/dex#connectors).

</TabItem>
</Tabs>

After you have configured the correct dex values for your OAuth provider, you can install dex via helm:
```
helm install dex stable/dex \
  --namespace loft \
  --set ingress.hosts[0]=my-dex-issuer.com \   # please make sure this domain is accessible for an user that should login into loft
  -f dex-values.yaml \
  --wait
```

## Configure an OIDC Provider in loft

In order to configure an OIDC provider in loft, you'll have to edit the `loft-config` configmap in the `loft` namespace (or the namespace you have installed loft to).
If you don't have an OIDC provider installed, check out the previous section for how to install dex.

An example configuration for an OIDC provider could look like this:
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: loft-config
  namespace: loft
data:
  config: |
    auth:
      oidc:
        issuerUrl: http://my-dex-issuer.com   # Required: The issuer url of the OIDC provider (example: https://dex.test.com)
        clientId: ""                          # Required: Client ID to use
        clientSecret: ""                      # Required: Client Secret to use
        usernameClaim: "email"                # Optional: The username claim within the ID token to use as kubernetes subject and loft username (default: email)
        usernamePrefix: ""                    # Optional: if specified, causes claims mapping to username to be prefix with the provided value (default: '')
        groupsClaim: ""                       # Optional: GroupsClaim, if specified, causes loft to try to populate the user's groups with an ID Token field (default: '')
        groupsPrefix: ""                      # Optional: if specified, causes claims mapping to group names to be prefixed with the value (default: '')
        caFile: "/path.crt"                   # Optional: Path to ca cert of the issuer within the loft container (default: '')
        type: "github"                        # Optional: if specified, changes the button appearance in the loft UI login page (default: '')
```

loft reloads this configuration periodically and you should be able to login via your preferred OIDC provider after some minutes.

For each new user that logs into loft that has not yet logged into loft, loft will create a new user object.
You can automatically assign users based on their ID Token groups to teams, by configuring the Kubernetes Groups in a loft team.

## Mirror Team Memberships

<DynamicMembershipFragment/>

## Disable Password Auth
To disable password authentication, upgrade your loft instance using helm:
```bash
helm upgrade -n loft loft loft --repo https://charts.devspace.sh \
  --reuse-values \
  --set config.auth.disablePassword=true
```

## loft as OIDC Provider
Loft can also act as an OIDC provider for other services, e.g. a self-hosted container registry using [Harbor](https://goharbor.io/docs/2.0.0/administration/configure-authentication/oidc-auth/).
